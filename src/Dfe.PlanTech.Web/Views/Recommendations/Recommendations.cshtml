@model Dfe.PlanTech.Web.Models.RecommendationsViewModel

@section Header {
    <link rel="stylesheet" as="style" href="~/css/step-by-step.css">
}

<div class="recommendation-content">
    @foreach (var headerWithContent in Model.AllContent)
    {
        <div class="recommendation-piece-container" id="@headerWithContent.SlugifiedHeader">
            <div class="recommendation-piece-header">
                @{
                    await Html.RenderPartialAsync("Components/Header", headerWithContent.Header);
                }
            </div>
            <div class="govuk-grid-row" id="top">
                <div class="govuk-grid-column-one-third">
                    <partial name="Components/VerticalNavigation/Default" model="@Model.Chunks"/>
                </div>
                <div class="govuk-grid-column-two-thirds">
                    <div class="govuk-section-break govuk-!-margin-top-0 govuk-section-break--m govuk-section-break--visible">
                        <div class="recommendation-piece-content">
                            @foreach (var content in headerWithContent.Content)
                            {
                                await Html.RenderPartialAsync("Components/PageComponentFactory", content);
                            }
                        </div>
                    </div>
                    <div>
                        <h2 class="govuk-heading-m">Share this recommendation</h2>
                        <p class="govuk-body">
                            <a class="govuk-link govuk-!-font-weight-bold" href="@Model.Slug/print" target="_blank">Share or download this recommendation in a checklist format</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section BodyEnd {
    <script async src="/js/step-by-step-navigation.js" nonce="@Context.Items["nonce"]"></script>
    <script defer src="/js/step-by-step-polyfills.js" nonce="@Context.Items["nonce"]"></script>

    <script async type="module" nonce="@Context.Items["nonce"]">
        function waitForGOVUK(callback, interval = 100) {
            if (typeof GOVUK !== 'undefined' && GOVUK.Modules?.AppStepNav !== undefined) {
                callback();
            } else {
                setTimeout(function() {
                    waitForGOVUK(callback);
                }, interval);
            }
        }

        waitForGOVUK(function() {
            const $element = document.querySelector('#step-by-step-navigation');
            new GOVUK.Modules.AppStepNav($element).init();
        });
    </script>
}