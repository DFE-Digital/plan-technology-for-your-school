@using Dfe.PlanTech.Application.Submission.Interfaces;
@using Dfe.PlanTech.Web.TagHelpers.TaskList
@model Dfe.PlanTech.Domain.Questionnaire.Interfaces.ICategory;
@inject IGetSubmissionStatusesQuery query

@{
    Model.SectionStatuses = query.GetSectionSubmissionStatuses(Model.Sections);
}
@{
    await Html.RenderPartialAsync("Components/PageComponentFactory", Model.Header);
}

@{
    foreach(var content in Model.Content){
        await Html.RenderPartialAsync("Components/PageComponentFactory", content);
    }
}

<task-list>
    @foreach (var categorySection in Model.Sections)
    {
        var tagColour = TagColour.Grey;
        var tagText = "NOT STARTED";
        var exists = Model.SectionStatuses.FirstOrDefault(x => x.SectionId == categorySection.Sys.Id);

        if (exists != null && exists!.Completed == 1)
        {
            tagColour = TagColour.DarkBlue;
            tagText = "COMPLETE";
        }
        else if (exists != null && exists!.Completed == 0)
        {
            tagColour = TagColour.Green;
            tagText = "STARTED";
        }

        <task-list-item>
            <task-list-item-name>
                <a asp-controller="Pages" asp-action="GetByRoute" asp-route-route="@categorySection.InterstitialPage.Slug" asp-route-param=@categorySection.Name+@categorySection.Sys.Id class="govuk-link">
                    @categorySection.Name
                </a>
            </task-list-item-name>
            
            <task-list-tag colour=@tagColour>
                @tagText
            </task-list-tag>
        </task-list-item>
    }
</task-list>