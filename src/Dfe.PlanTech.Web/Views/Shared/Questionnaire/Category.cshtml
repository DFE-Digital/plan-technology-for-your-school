@using Dfe.PlanTech.Application.Submission.Interfaces;
@using Dfe.PlanTech.Web.TagHelpers.TaskList
@model Dfe.PlanTech.Domain.Questionnaire.Interfaces.ICategory;
@inject IGetSubmissionStatusesQuery query

@{
    Model.SectionStatuses = await query.GetSectionSubmissionStatuses();
}
@{
    await Html.RenderPartialAsync("Components/PageComponentFactory", Model.Header);
}

@{
    foreach(var content in Model.Content){
        await Html.RenderPartialAsync("Components/PageComponentFactory", content);
    }
}

<task-list>
    @foreach (var categorySection in Model.Sections)
    {
        var tagColour = TagColour.Grey;
        var tagText = "NOT STARTED";
        Model.SectionStatuses.TryGetValue(categorySection.Sys.Id, out string value);

        switch(value)
        {
            case "Started":
                tagColour = TagColour.Green;
                tagText = "STARTED";
                break;
            case "Completed":
                tagColour = TagColour.DarkBlue;
                tagText = "COMPLETE";
                break;
            case "Not Started":
            default:
                break;
        }

        <task-list-item>
            <task-list-item-name>
                <a asp-controller="Pages" asp-action="GetByRoute" asp-route-route="@categorySection.InterstitialPage.Slug" asp-route-param=@categorySection.Name+@categorySection.Sys.Id class="govuk-link">
                    @categorySection.Name
                </a>
            </task-list-item-name>
            
            <task-list-tag colour=@tagColour>
                @tagText
            </task-list-tag>
        </task-list-item>
    }
</task-list>