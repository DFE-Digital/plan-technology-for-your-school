@using Dfe.PlanTech.Domain.Questionnaire.Interfaces;

@model Dfe.PlanTech.Domain.Content.Models.Page;

@{
    foreach (var content in Model.BeforeTitleContent)
    {
        await Html.RenderPartialAsync("Components/PageComponentFactory", content);
    }

    if (Model.DisplayTopicTitle)
    {
        <span class="govuk-caption-xl">@Model.SectionTitle</span>
    }

    if (Model.Title != null)
    {
        await Html.RenderPartialAsync("Components/Title", Model.Title);
    }

    var categoriesList = new List<ICategoryComponent>();

    var showRecommendations = false;

    foreach (var content in Model.Content)
    {
        await Html.RenderPartialAsync("Components/PageComponentFactory", content);

        if (content is ICategoryComponent category)
        {
            showRecommendations = true;
            categoriesList.Add(category);
        }
    }

    if (showRecommendations)
    {
        @await Component.InvokeAsync("Recommendations", new { categories = categoriesList.ToArray() })
    }
}