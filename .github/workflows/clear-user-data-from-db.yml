name: Clear user data from DB

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "What environment to clear"
        required: true
        type: environment

env:
  DOTNET_VERSION: ${{ vars.DOTNET_VERSION }}

jobs:
  disallow-prod-message:
    if: inputs.environment == 'Production'
    name: Disallow production message
    runs-on: ubuntu-latest

    steps:
      - name: Disallow production message
        run: echo "This action is not allowed in production"

  clear-db:
    if: inputs.environment != 'Production'
    environment: ${{ inputs.environment }}
    name: Clear user data from DB
    runs-on: ubuntu-latest
    env:
      az_keyvault_name: ${{ secrets.AZ_ENVIRONMENT }}${{ secrets.DFE_PROJECT_NAME }}-kv
      az_keyvault_database_connectionstring_name: ${{ secrets.AZ_KEYVAULT_DATABASE_CONNECTIONSTRING_NAME }}
      az_sql_database_server_name: ${{ secrets.AZ_ENVIRONMENT }}${{ secrets.DFE_PROJECT_NAME }}
      az_resource_group_name: ${{ secrets.AZ_ENVIRONMENT }}${{ secrets.DFE_PROJECT_NAME }}
      SQL_IP_NAME: github-action-clear-user-data

    steps:
      - name: IS NOT PROD
        run: echo 'IS NOT PROD'
